## Темы модуля 02: Как задать AI‑агенту формат вывода

- **Зачем нужен строгий формат**
  - Стабильный парсинг и последующая обработка (пайплайны, БД, UI).
  - Снижение «болтовни» и домыслов за счёт чётких правил.

- **Подходы к зафиксированному формату**
  - Промпт + шаблон: включаем схему (ключи, типы, правила) из внешнего `template.json` в системное сообщение.
  - Tool/Function‑calling: описываем схему входа/выхода инструмента и просим модель вызывать его (даёт структурированный JSON).
  - Валидация и повтор: проверяем JSON на стороне кода, при ошибке — короткий перезапрос/починка.

- **Приёмы повышения надёжности**
  - «Без комментариев вокруг JSON»: только структура, без лишнего текста.
  - Неизвестные значения → `null` или пустые массивы; ключи — как в схеме.
  - Температура ниже (меньше вариативности), минимум «вольного текста».

- **Практика в модуле**
  - `FormattingAgent` читает `template.json`, добавляет схему и правила в системный промпт.
  - Авто‑детект формата ответа (JSON/YAML/XML/текст) и «ограждение» в ``` для стабильного рендера.

- **Рекомендации**
  - Держите схему и правила в файле (`template.json`) для быстрой правки без изменения кода.
  - Добавляйте короткие негативные примеры: «не добавляй текст до/после JSON».

### Источники и материалы
- OpenAI — Function/Tool calling: [platform.openai.com/docs/guides/function-calling](https://platform.openai.com/docs/guides/function-calling)
- OpenAI — Structured outputs (JSON): [platform.openai.com/docs/guides/structured-outputs](https://platform.openai.com/docs/guides/structured-outputs)
- JSON Schema: [json-schema.org](https://json-schema.org/)
- Pydantic (валидация структур): [docs.pydantic.dev](https://docs.pydantic.dev/)
